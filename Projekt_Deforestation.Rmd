---
title: "Deforestation_Brazil"
output: html_document
date: "2025-01-16"
---

Hypothesen:
- Abholzung in Brasilien korreliert mit klima im Breitengradenintervall
- TODO: Brandrodung in Brasilien nimmt Anteilig zum Netloss zum -> Barchart mit Anteilen
- 

Daten werden eingelesen
```{r}
library(ggplot2)
library(scales)
```

```{r setup, include=FALSE}
# Installiere und lade benötigte Pakete
if (!require(tidyverse)) install.packages("tidyverse")
if (!require(tidytuesdayR)) install.packages("tidytuesdayR")
if (!require(readr)) install.packages("readr")

# Deforstation Data einlesen mit tidytuesdayR
# Installiere und lade das tidytuesdayR-Paket
tuesdata <- tidytuesdayR::tt_load('2021-04-06')
tuesdata <- tidytuesdayR::tt_load(2021, week = 15)

forest_change <- tuesdata$forest_change

# Alternativ manuell lesen
forest <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2021/2021-04-06/forest.csv')
forest_area <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2021/2021-04-06/forest_area.csv')
brazil_loss <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2021/2021-04-06/brazil_loss.csv')
soybean_use <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2021/2021-04-06/soybean_use.csv')
vegetable_oil <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2021/2021-04-06/vegetable_oil.csv')

# Temperaturdaten mit tidytuesdayR einlesen
tuesdata <- tidytuesdayR::tt_load('2023-07-11')
tuesdata <- tidytuesdayR::tt_load(2023, week = 28)

global_temps <- tuesdata$global_temps
nh_temps <- tuesdata$nh_temps
sh_temps <- tuesdata$sh_temps
zonann_temps <- tuesdata$zonann_temps

# Alternativ manuell lesen
global_temps <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2023/2023-07-11/global_temps.csv')
nh_temps <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2023/2023-07-11/nh_temps.csv')
sh_temps <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2023/2023-07-11/sh_temps.csv')
zonann_temps <- readr::read_csv('https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data/2023/2023-07-11/zonann_temps.csv')



# Temperatur Data einlesen
#temperature_url <- "https://raw.githubusercontent.com/rfordatascience/tidytuesday/main/data#/2023/2023-07-11/global_temps.csv"
#temperature_data <- read_csv(temperature_url)

```


Daten werden jetzt bearbeitet 

```{r}
brazil_loss <- brazil_loss %>%
  rowwise() %>%
  mutate(Net_Loss = sum(across(!c(entity, code, year)), na.rm = TRUE)) %>%
  ungroup()

brazil_loss_net <- brazil_loss %>%
  select(year, Net_Loss, entity)
```

```{r}
# Calculate the proportion of each deforestation category relative to the total deforestation
brazil_loss_long <- brazil_loss_long %>%
  group_by(year, category) %>%
  summarise(total_value = sum(value, na.rm = TRUE)) %>%
  mutate(proportion = total_value / sum(total_value, na.rm = TRUE))

# Plot the proportion of each deforestation category over time using a line plot
ggplot(brazil_loss_long, aes(x = year, y = proportion, color = category)) +
  geom_line(size = 1) +
  scale_y_continuous(labels = scales::percent) +
  labs(title = "Proportion of Deforestation Categories Over Time",
       x = "Year",
       y = "Proportion of Total Deforestation",
       color = "Category") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    axis.title = element_text(size = 14),
    axis.text = element_text(size = 12),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 10)
  )
```

```{r}
# Create a barchart with stacked bars for each year
brazil_loss_long <- brazil_loss %>%
  pivot_longer(cols = -c(entity, code, year, Net_Loss), names_to = "category", values_to = "value")

ggplot(brazil_loss_long, aes(x = year, y = value, fill = category)) +
  geom_bar(stat = "identity") +
  labs(title = "Deforestation Categories Over the Years",
       x = "Year",
       y = "Deforestation (in Hectares)",
       fill = "Category") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    axis.title = element_text(size = 14),
    axis.text = element_text(size = 12),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 10)
  )
```



```{r}
# Calculate the proportion of each deforestation category relative to the total deforestation
brazil_loss_long <- brazil_loss_long %>%
  group_by(year) %>%
  mutate(proportion = value / sum(value, na.rm = TRUE))

# Plot the proportion of each deforestation category over time
ggplot(brazil_loss_long, aes(x = year, y = proportion, fill = category)) +
  geom_bar(stat = "identity", position = "fill") +
  scale_y_continuous(labels = scales::percent) +
  labs(title = "Proportion of Deforestation Categories Over Time",
       x = "Year",
       y = "Proportion of Total Deforestation",
       fill = "Category") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    axis.title = element_text(size = 14),
    axis.text = element_text(size = 12),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 10)
  )
```

```{r}
# Plot der Abholzung in Brasilien über die Jahre
ggplot(brazil_loss, aes(x = year, y = Net_Loss)) +
  geom_line(color = "darkgreen") +
  labs(title = "Abholzung in Brasilien über die Jahre",
       x = "Jahr",
       y = "Abholzung (in Hektar)") +
  theme_minimal()
```




```{r setup, include=FALSE}
# Selektiere die Spalten "year" und "24S-EQU" aus der zonann_temps Tabelle
temps <- zonann_temps %>%
  select(Year, `24S-EQU`, Glob)
# Rename the column "Year" to "year" in temps
temps <- temps %>%
  rename(year = Year)
# Merge temps and brazil_loss using the column Year
merged_data <- inner_join(temps, brazil_loss_net, by = "year")
merged_data
```

How does the temperature anomaly in the 24S-EQU region compare to the global temperature anomaly over time? Let's visualize this comparison using a line plot.

```{r}
library(ggplot2)

# Plot the columns 24S-EQU and Glob against year
ggplot(data = merged_data, aes(x = year)) +
  geom_line(aes(y = `24S-EQU`, color = "24S-EQU"), size = 1) +
  geom_line(aes(y = Glob, color = "Glob"), size = 1, linetype = "dashed") +
  scale_color_manual(values = c("24S-EQU" = "blue", "Glob" = "red")) +
  labs(title = "Temperature Changes Over Time",
       subtitle = "Comparing 24S-EQU and Global Temperature Anomalies",
       x = "Year",
       y = "Temperature Anomaly (°C)",
       color = "Legend") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 12),
    axis.title = element_text(size = 14),
    axis.text = element_text(size = 12),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 10)
  )
```

# Plot the columns 24S-EQU and Net_Loss against year with two y-axes

```{r}
library(ggplot2)
library(scales)

# Create a plot with two y-axes
ggplot(data = merged_data, aes(x = year)) +
  geom_line(aes(y = `24S-EQU`, color = "24S-EQU"), size = 1) +
  geom_line(aes(y = Net_Loss / 1000000, color = "Net_Loss"), size = 1, linetype = "dashed") +
  scale_y_continuous(
    name = "Temperature in 24S-EQU (°C)",
    sec.axis = sec_axis(~ . * 1000000, name = "Net Loss (in Hectares)")
  ) +
  scale_color_manual(values = c("24S-EQU" = "blue", "Net_Loss" = "brown")) +
  labs(title = "24S-EQU Temperature Anomaly and Net Loss Over Time",
       x = "Year",
       color = "Legend") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    axis.title.y = element_text(color = "blue", size = 14),
    axis.title.y.right = element_text(color = "brown", size = 14),
    axis.text.y.right = element_text(color = "brown"),
    axis.text.y = element_text(color = "blue")
  )
```

```{r}
max_temp <- max(merged_data$`24S-EQU`, na.rm = TRUE)
max_loss <- max(merged_data$Net_Loss, na.rm = TRUE)

merged_data <- merged_data %>%
  mutate(
    norm_24S_EQU = `24S-EQU` / max_temp,
    norm_Net_Loss = Net_Loss / max_loss
  )

ggplot(data = merged_data, aes(x = year)) +
  geom_line(aes(y = norm_24S_EQU, color = "24S-EQU"), size = 1) +
  geom_line(aes(y = norm_Net_Loss, color = "Net Loss"), size = 1, linetype = "dashed") +
  scale_y_continuous(
    name = "Normalized Value",
    sec.axis = sec_axis(~ . * max_loss, name = "Net Loss (in Hectares)")
  ) +
  scale_color_manual(values = c("24S-EQU" = "blue", "Net Loss" = "green")) +
  labs(title = "Normalized 24S-EQU Temperature Anomaly and Net Loss Over Time",
       subtitle = "Comparing Normalized 24S-EQU Temperature Anomaly and Net Loss",
       x = "Year",
       color = "Legend") +
  theme_minimal() +
  theme(
    plot.title = element_text(hjust = 0.5, size = 16, face = "bold"),
    plot.subtitle = element_text(hjust = 0.5, size = 12),
    axis.title = element_text(size = 14),
    axis.text = element_text(size = 12),
    legend.title = element_text(size = 12),
    legend.text = element_text(size = 10)
  )
```



```{r}
# Berechne die Korrelation zwischen Net_Loss und 24S-EQU
correlation_pearson <- cor(merged_data$Net_Loss, merged_data$`24S-EQU`, method = "pearson", use = "complete.obs")
correlation_pearson
```
Based on the data, we can not conclude that there is a significant correlation between the temperature anomaly in the 24S-EQU region and net loss in Brazil over time. 
This lack of significant correlation might be due to the limited temporal scope of the data. Expanding the temporal scope or considering additional factors might provide more insights into the relationship between these variables.
# TODO: argumentieren, dass wir hier Temperaturen von Breitengradenintervall anschauen